@namespace OpenHFT.GUI.Components.Layout
@using OpenHFT.GUI.Services

<MudPaper Elevation="4" Square="true" Class="d-flex align-center pa-2 gap-4" Style="flex-shrink: 0;">
    @foreach (var server in _omsServers)
    {
        var currentStatus = _statuses.GetValueOrDefault(server.OmsIdentifier, ConnectionStatus.Disconnected);

        <MudPaper Outlined="true" Class="pa-2" Style="min-width: 250px;">
            <MudGrid Spacing="1" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">

                @* Left Column: Server Name and Status *@
                <MudItem xs="7">
                    <MudText Typo="Typo.body1" Style="font-weight: bold;">@server.OmsIdentifier</MudText>
                    <MudText Typo="Typo.body1" Color="@GetStatusColor(server)" Variant="Variant.Outlined">
                        @currentStatus.ToString()
                    </MudText>
                </MudItem>

                @* Right Column: Action Buttons *@
                <MudItem xs="5" Class="d-flex flex-column gap-1">
                    <MudButton Size="Size.Small" Variant="Variant.Filled" Color="Color.Primary"
                        OnClick="() => HandleConnectClick(server)"
                        Disabled="@(currentStatus == ConnectionStatus.Connected)">
                        @if (currentStatus == ConnectionStatus.Connecting)
                        {
                            <MudProgressCircular Size="Size.Small" Indeterminate="true" />
                        }
                        else
                        {
                            <text>Connect</text>
                        }
                    </MudButton>
                    <MudButton Size="Size.Small" Variant="Variant.Outlined" OnClick="() => HandleDisconnectClick(server)"
                        Disabled="@(currentStatus == ConnectionStatus.Disconnected)">
                        Disconnect
                    </MudButton>
                </MudItem>

            </MudGrid>
        </MudPaper>
    }
    <MudSpacer />
</MudPaper>