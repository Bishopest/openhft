@using OpenHFT.Oms.Api.WebSocket
@namespace OpenHFT.GUI.Components.Shared

<MudPaper Class="pa-2 d-flex flex-column" Style="height: 100%;">
    <div class="flex-grow-1" style="overflow-y: auto; min-height: 0;">
        <MudText Typo="Typo.h6" GutterBottom="true">Active Strategies</MudText>
        <MudTable Items="@Instances" T="InstanceStatusPayload" Dense="true" Hover="true" SortLabel="Sort By"
            SelectedItem="SelectedInstance" SelectedItemChanged="OnRowClicked">
            <HeaderContent>
                <MudTh Style="width: 40px;"></MudTh>
                <MudTh>
                    <MudTableSortLabel SortBy="new Func<InstanceStatusPayload, object>(x => GetExchange(x))">Exchange
                    </MudTableSortLabel>
                </MudTh>
                <MudTh>
                    <MudTableSortLabel SortBy="new Func<InstanceStatusPayload, object>(x => GetSymbol(x))">Symbol
                    </MudTableSortLabel>
                </MudTh>
                <MudTh>
                    <MudTableSortLabel SortBy="new Func<InstanceStatusPayload, object>(x => x.IsActive)">Status
                    </MudTableSortLabel>
                </MudTh>
                <MudTh>
                    <MudTableSortLabel SortBy="new Func<InstanceStatusPayload, object>(x => x.Parameters.SpreadBp)">
                        Spread
                    </MudTableSortLabel>
                </MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd DataLabel="Selected">
                    @* This icon will only appear on the currently selected row. *@
                    @if (SelectedInstance is not null && SelectedInstance.InstrumentId == context.InstrumentId)
                    {
                        <MudIcon Icon="@Icons.Material.Filled.ArrowRight" Color="Color.Primary" />
                    }
                </MudTd>
                <MudTd DataLabel="Exchange">@GetExchange(context)</MudTd>
                <MudTd DataLabel="Symbol">@GetSymbol(context)</MudTd>
                <MudTd DataLabel="Status">
                    <MudChip T='string' Color="@(context.IsActive? Color.Success: Color.Warning)" Size="Size.Small">
                        @(context.IsActive ? "Active" : "Inactive")
                    </MudChip>
                </MudTd>
                <MudTd DataLabel="Spread">@context.Parameters.SpreadBp bp</MudTd>
            </RowTemplate>
            <PagerContent>
                <MudTablePager />
            </PagerContent>
        </MudTable>
    </div>
</MudPaper>