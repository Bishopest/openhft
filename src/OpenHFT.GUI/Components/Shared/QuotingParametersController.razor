@namespace OpenHFT.GUI.Components.Shared
@using OpenHFT.Core.Models
@using OpenHFT.Core.Instruments
<MudPaper Class="pa-4" Style="height: 100%;">
    <MudPaper Elevation="@(IsStrategyActive ? 8 : 0)"
        Class="@(IsStrategyActive ? "pa-2 rounded-lg mud-theme-success" : "pa-2")"
        Style="transition: background-color 0.3s;">
        <MudText Typo="Typo.h6" GutterBottom="true">
            Deploy @(IsStrategyActive ? "(Active)" : "New") Strategy
        </MudText>
    </MudPaper>
    <MudForm @ref="_form">
        <MudStack Spacing="3">
            <MudAutocomplete T="Instrument" Label="Instrument" SearchFunc="@SearchInstruments"
                ToStringFunc="@ConvertInstrumentToString" @bind-Value="SelectedInstrument" Variant="Variant.Outlined"
                Required="true" ResetValueOnEmptyText="true" CoerceText="true" CoerceValue="true">
                <ItemTemplate Context="instrument">@instrument.Symbol (@instrument.SourceExchange)
                    (@instrument.ProductType)</ItemTemplate>
            </MudAutocomplete>
            <MudSelect @bind-Value="_model.FvModel" Label="Fair Value Model" Variant="Variant.Outlined" Required="true">
                @foreach (FairValueModel fv in Enum.GetValues(typeof(FairValueModel)))
                {
                    <MudSelectItem Value="fv">@fv.ToString()</MudSelectItem>
                }
            </MudSelect>
            <MudSelect @bind-Value="_model.Type" Label="Quote Type" Variant="Variant.Outlined" Required="true">
                @foreach (QuoterType type in Enum.GetValues(typeof(QuoterType)))
                {
                    <MudSelectItem Value="type">@type.ToString()</MudSelectItem>
                }
            </MudSelect>
            <MudNumericField @bind-Value="_model.SpreadBp" Label="Spread (bp)" Variant="Variant.Outlined"
                Required="true" Min="0" />
            <MudNumericField @bind-Value="_model.SkewBp" Label="Skew (bp)" Variant="Variant.Outlined" Required="true" />
            <MudNumericField @bind-Value="_model.Size" Label="Size (Quantity)" Variant="Variant.Outlined"
                Required="true" Min="0" Step="0.001m" />
            <MudNumericField @bind-Value="_model.Depth" Label="Depth (Levels)" Variant="Variant.Outlined"
                Required="true" Min="1" />
            <MudAutocomplete T="Instrument" Label="FV Source Instrument" @bind-Value="_selectedFvSourceInstrument"
                SearchFunc="@SearchInstruments" ToStringFunc="@ConvertInstrumentToString" Variant="Variant.Outlined"
                Clearable="true" ResetValueOnEmptyText="true" CoerceText="false" CoerceValue="false">
                <ItemTemplate Context="instrument">
                    @instrument.Symbol (@instrument.SourceExchange) (@instrument.ProductType)
                </ItemTemplate>
                <NoItemsTemplate>
                    <MudText Class="pa-4">No matching instruments found.</MudText>
                </NoItemsTemplate>
            </MudAutocomplete>
            <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="HandleSubmit" Class="mt-4">Submit
            </MudButton>
            <MudButton Variant="Variant.Outlined" Color="Color.Secondary" OnClick="HandleCancel">Cancel</MudButton>
        </MudStack>
    </MudForm>
</MudPaper>