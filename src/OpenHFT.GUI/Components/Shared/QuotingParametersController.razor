@namespace OpenHFT.GUI.Components.Shared
@using OpenHFT.Core.Models
@using OpenHFT.Core.Instruments
<MudPaper Class="pa-4" Style="height: 100%;">
    <MudForm @ref="_form">
        <MudStack Spacing="3">
            <MudAutocomplete T="Instrument" Label="Instrument" SearchFunc="@SearchInstruments"
                ToStringFunc="@ConvertInstrumentToString" @bind-Value="SelectedInstrument" Variant="Variant.Outlined"
                Required="true" ResetValueOnEmptyText="true" CoerceText="true" CoerceValue="true">
                <ItemTemplate Context="instrument">@instrument.Symbol (@instrument.SourceExchange)
                    (@instrument.ProductType)</ItemTemplate>
            </MudAutocomplete>
            <MudSelect @bind-Value="_model.FvModel" Label="Fair Value Model" Variant="Variant.Outlined" Required="true">
                @foreach (FairValueModel fv in Enum.GetValues(typeof(FairValueModel)))
                {
                    <MudSelectItem Value="fv">@fv.ToString()</MudSelectItem>
                }
            </MudSelect>
            <MudSelect @bind-Value="_model.Type" Label="Quote Type" Variant="Variant.Outlined" Required="true">
                @foreach (QuoterType type in Enum.GetValues(typeof(QuoterType)))
                {
                    <MudSelectItem Value="type">@type.ToString()</MudSelectItem>
                }
            </MudSelect>
            <MudGrid>
                <MudItem xs="12" sm="6">
                    <MudNumericField @bind-Value="_model.AskSpreadBp" Label="Spread A (bp)" Variant="Variant.Outlined"
                        Required="true" Validation="@(new Func<decimal, string>(AskSpreadValidation))" />
                </MudItem>
                <MudItem xs="12" sm="6">
                    <MudNumericField @bind-Value="_model.BidSpreadBp" Label="Spread B (bp)" Variant="Variant.Outlined"
                        Required="true" Validation="@(new Func<decimal, string>(BidSpreadValidation))" />
                </MudItem>
            </MudGrid>
            <MudNumericField @bind-Value="_model.SkewBp" Label="Skew (bp)" Variant="Variant.Outlined" Required="true" />
            <MudGrid>
                <MudItem xs="12" sm="6">
                    <MudNumericField Format="N0" @bind-Value="_model.MaxCumBidFills" Label="Max Cum Bid Fills" Variant="Variant.Outlined" Required="true" Min="0" />
                </MudItem>
                <MudItem xs="12" sm="6">
                    <MudNumericField Format="N0" @bind-Value="_model.MaxCumAskFills" Label="Max Cum Ask Fills" Variant="Variant.Outlined" Required="true" Min="0" />
                </MudItem>
            </MudGrid>
            <MudNumericField Format="N0" @bind-Value="_model.Size" Label="Size (Quantity)" Variant="Variant.Outlined"
                Required="true" Min="0" Step="0.001m" />
            <MudNumericField @bind-Value="_model.Depth" Label="Depth (Levels)" Variant="Variant.Outlined"
                Required="true" Min="1" />
            <MudAutocomplete T="Instrument" Label="FV Source Instrument" @bind-Value="_selectedFvSourceInstrument"
                SearchFunc="@SearchInstruments" ToStringFunc="@ConvertInstrumentToString" Variant="Variant.Outlined"
                Clearable="true" ResetValueOnEmptyText="true" CoerceText="false" CoerceValue="false">
                <ItemTemplate Context="instrument">
                    @instrument.Symbol (@instrument.SourceExchange) (@instrument.ProductType)
                </ItemTemplate>
                <NoItemsTemplate>
                    <MudText Class="pa-4">No matching instruments found.</MudText>
                </NoItemsTemplate>
            </MudAutocomplete>
            <MudSwitch T="bool" Value="@_model.PostOnly" ValueChanged="TogglePostOnly" Label="PostOnly" Color="Color.Success" />
            <MudSelect T="string" @bind-Value="_selectedOmsIdentifier" Label="Target OMS" Variant="Variant.Outlined" Required="true"
                       Disabled="IsStrategyActive"> @* Disable if a strategy is already active/selected *@
                @foreach (var server in _availableOmsServers)
                {
                    <MudSelectItem T="string" Value="@server.OmsIdentifier">@server.OmsIdentifier</MudSelectItem>
                }
            </MudSelect>
            <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="HandleSubmit" Class="mt-4">Submit
            </MudButton>
            <MudButton Variant="Variant.Outlined" Color="Color.Secondary" OnClick="HandleCancel">Cancel</MudButton>
        </MudStack>
    </MudForm>
</MudPaper>