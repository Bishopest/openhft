@page "/"
@using OpenHFT.Core.Interfaces
@using OpenHFT.GUI.Components.Shared
@using OpenHFT.GUI.Services
@using OpenHFT.Core.Instruments
@using OpenHFT.Core.Models

@inject IInstrumentRepository InstrumentRepository

@inherits ComponentBase

@namespace OpenHFT.GUI.Components.Pages

<PageTitle>Home</PageTitle>

@*
    CHANGE 1: This MudContainer becomes a full-height, column-oriented flex container.
    - 'd-flex flex-column': Turns it into a flex container.
    - 'flex-grow-1': This is the KEY. It makes the container expand to fill all
      available vertical space within the MainLayout.
*@
<MudPaper Class="pa-2" Elevation="2">
    <MudStack Spacing="4">
        @* --- OMS Connection Component --- *@
        @* We pass down the server list and current status, and listen for connect/disconnect events *@
        <OmsConnectionManager Servers="_omsServers" CurrentStatus="_currentStatus" OnConnect="HandleConnectRequest"
            OnDisconnect="HandleDisconnectRequest" />

        <MudGrid Spacing="2">
            @* --- Instance List (Left Side) --- *@
            <MudItem xs="12" md="5">
                <InstanceListView Instances="_activeInstances" SelectedInstance="_selectedInstance"
                    OnInstanceSelected="HandleInstanceSelection" />
            </MudItem>

            @*
            CHANGE 2: This MudGrid also becomes a growing flex item.
            It will now fill all the space NOT taken by the h1 and MudText above it.
            'AlignItems.Stretch' ensures the MudItems inside it also stretch vertically.
            *@
            @* --- Main Content (Right Side) --- *@
            <MudItem xs="12" md="7">
                <MudGrid Spacing="2">
                    <MudItem xs="12" md="8">
                        <OrderBookDisplay
                            DisplayInstrument="@(_selectedInstance != null ? InstrumentRepository.GetById(_selectedInstance.InstrumentId) : null)" />
                    </MudItem>
                    <MudItem xs="12" md="4">
                        <QuotingParametersController @ref="_quotingController" OnSubmit="HandleSubmitParameters"
                            OnCancel="HandleCancelParameters" />
                    </MudItem>
                </MudGrid>
            </MudItem>
        </MudGrid>
    </MudStack>
</MudPaper>