@page "/"
@using OpenHFT.Core.Interfaces
@using OpenHFT.GUI.Components.Shared
@using OpenHFT.GUI.Services
@using OpenHFT.Core.Instruments
@using OpenHFT.Core.Models

@inherits ComponentBase

@namespace OpenHFT.GUI.Components.Pages

<PageTitle>Home</PageTitle>

@* 부모 높이를 꽉 채우기 위해 height: 100%와 flex 설정을 추가합니다 *@
<MudPaper Class="pa-2 flex-grow-1" Elevation="0" Style="height: calc(100vh - 80px); overflow: hidden;">
    <MudGrid Spacing="2" Style="height: 100%;">
        
        @* --- Left Side (Fills + Instances + Hedger + Orders) --- *@
        <MudItem xs="12" md="6" Style="height: 100%; display: flex; flex-direction: column;">
            <MudStack Spacing="2" Style="height: 100%; overflow: hidden;">
                
                @* FillsView도 높이를 지정해주는 것이 좋습니다 (예: 25%) *@
                <div style="height: 30%; overflow: hidden;">
                    <FillsView />
                </div>

                @* InstanceList (25%) *@
                <div style="height: 35%; overflow: hidden;">
                    <InstanceListView Instances="_activeInstances" SelectedInstance="_selectedInstance"
                        OnInstanceSelected="HandleInstanceSelection" />
                </div>
                @* ActiveOrders (25%) - 이제 부모가 높이를 잡고 있으므로 밀려나지 않습니다 *@
                <div style="height: 35%; overflow: hidden;">
                    <ActiveOrdersView OmsIdentifier="@_selectedInstance?.OmsIdentifier"
                        InstrumentId="@_selectedInstance?.InstrumentId" />
                </div>
            </MudStack>
        </MudItem>

        @* --- Main Content (Right Side) --- *@
        <MudItem xs="12" md="6" Style="height: 100%;">
            <MudGrid Spacing="2" Style="height: 100%;">
                <MudItem xs="12" md="8" Style="height: 100%;">
                    <div style="height: 70%; overflow: hidden;">
                        <OrderBookDisplay ActiveInstance="_selectedInstance" />
                    </div>
                    <div style="height: 30%; overflow: hidden;">
                        @* HedgingController (25%) *@
                        <HedgingParametersController @ref="_hedgingController"
                                                 QuotingInstrument="@(_selectedInstance != null ? InstrumentRepository.GetById(_selectedInstance.InstrumentId) : null)"
                                                 IsHedgerActive="@(_hedgingStatus?.IsActive ?? false)"
                                                 OnStart="HandleStartHedging"
                                                 OnStop="HandleStopHedging" />
                    </div>
                </MudItem>
                <MudItem xs="12" md="4" Style="height: 100%; display: flex; flex-direction: column;">
                    @* 컨테이너 높이를 100%로 잡고, 내용이 많으면 스크롤바가 생기도록 합니다 *@
                    <div style="flex-grow: 1; overflow-y: auto; padding-right: 8px;">
                        <QuotingParametersController @ref="_quotingController" 
                                                    OnSubmit="HandleSubmitParameters"
                                                    OnCancel="HandleCancelParameters" />
                    </div>
                </MudItem>
            </MudGrid>
        </MudItem>
    </MudGrid>
</MudPaper>